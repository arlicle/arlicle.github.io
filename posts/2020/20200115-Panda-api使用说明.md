{
    :title "Panda api 接口文档工具使用说明"
    :post-date "2020-01-15 18:58"
}


Panda api的接口文档工具是一个简单、易用、又强大的接口文档管理工具。我们直接从一个例子开始了解他吧。

### 定义一个用户操作的接口文档
我们创建一个目录，起名为api-docs，然后再这个目录中创建`auth.json`文件，然后敲上下面的代码

```.language-json
{
    "name":"用户操作",
    "desc":"用户登录系统、退出登录系统",
    "order":1,
    "api":
    [{
        "name":"用户登录",
        "desc":"用户登录成功，接口会返回一个token",
        "method": "POST",
        "url":"/login/",
        "body_mode":"json",
        "body":{
            "username":{"name":"用户名"},
            "password":{"name":"用户登录密码"}
        },
        "response":{
            "code":{"name":"返回结果的代码", "type":"int", "desc":"登录成功只返回1"},
            "msg":{"name":"登录成功返回消息", "type":"string", "desc":"通常返回都是空"},
            "token":{"name":"登录成功返回的用户token", "type":"string", "required":false}
        },
        "test_data":[
            {
                "body":{"username":"edison", "password":"123"},
                "response":{"code":-1, "msg":"密码输入不正确"}
            },
            {
                "body":{"username":"lily", "password":"123"},
                "response":{"code":-2, "msg":"用户名不存在"}
            },
            {
                "body":{"username":"root", "password":"123"},
                "response":{"code":1, "msg":"登录成功", "token":"fjdlkfjlafjdlaj3jk2l4j"}
            },
            {
                "body":{"username":"lily"},
                "response":{"code":-1, "msg":"密码是必填的"}
            },
            {
                "body":{"password":"123"},
                "response":{"code":-1, "msg":"用户名是必填的"}
            }
        ]
    },
    {
        "name":"用户退出登录",
        "method":"GET",
        "url":"/logout/"
        "query":{
            "id":{"name":"用户id"},
            "username":{"name":"用户名"}
        },
        "response":{
            "code":{"name":"返回结果的代码", "type":"int", "desc":"退出成功只返回1"},
            "msg":{"name":"退出操作返回消息", "type":"string", "desc":"通常返回都是空"}
        },
        "test_data":[
            {
                "response":{"code":1, "msg":"退出成功"}
            }
        ]
    }
]}

```

当我们保存好这个文档后，就可以运行命令 `panda-api`，就会运行起接口文档服务，

我们就可以在浏览器中输入网址 `http://localhost:9000`来访问这个文档了。

✌️耶~！我们有接口文档啦！O(∩_∩)O哈哈~！

继续还有更强大的。

同时，我们的panda-api或已经开始为我们的前端提供了接口服务，我们的前端开发人员，或者我们用postman就可以测试请求用户登录接口，也就是请求 `http://localhost:9000/login/` 这个地址。提交的参数就是username和password。

当我们提交的参数是
```.language-json
{"username":"edison", "password":"123"}
```
我们会得到返回结果
```.language-json
{"code":-1, "msg":"密码输入不正确"}
```

当我们提交的参数是
```.language-json
{"username":"root", "password":"123"}
```
我们会得到返回结果
```.language-json
{"code":1, "msg":"登录成功", "token":"fjdlkfjlafjdlaj3jk2l4j"}
```
注意到没，我们请求的参数和返回结果，就是我们再test_data里面设置的数据集，这个数据集中body和response是一一对应的，

我们前端就可以使用这个数据集进行开发了，测试各种各样我们想要的特殊情况，我们还可以继续往里面增加各种测试数据。

下面我们把这个接口文档的每一个部分都详细说明一下

### 接口文档的根字段
我们定义了一个用户的接口文档，在接口文档的最根节点有三个字段：
```.language-json
"name":"用户操作",  // 当前接口文档名称
"desc":"用户登录系统、退出登录系统", // 当前接口文档描述说明
"order":1, // 表示有多个文档时，当前文档在列表中的排序
"api":[...] // 当前接口文档的接口列表
```
在这个用户操作的接口文档中，我们再api这个列表里面定义了两个接口，用户登录接口和用户退出登录接口，我们先来看用户登录接口



### 用户登录接口

```.language-json
{
"name":"用户登录", // 接口的名称
"desc":"用户登录成功，接口会返回一个token", // 接口的描述说明 (可选)，不写时默认为空
"method": "POST", // 接口的请求方法 (可选) 不写时默认是GET
"url":"/login/", // 接口请求的url地址
"body_mode":"json", // 请求的数据格式
"body":{           // post 请求的 body 字段说明,
    "username":{"name":"用户名"},
    "password":{"name":"用户登录密码"}
},
"response":{
    "code":{"name":"返回结果的代码", "type":"int", "desc":"登录成功只返回1"},
    "msg":{"name":"登录成功返回消息", "type":"string", "desc":"通常返回都是空"},
    "token":{"name":"登录成功返回的用户token", "type":"string", "required":false}
},
"test_data":[...]
}
```

其中当请求method是POST的时候，body_mode和body字段设置了才会有效，当请求method是GET的时候，对应的字段是query。

body中的第一个字段username的属性是{"name":"用户名"}, 这个属性的完整写法是
```.language-json
"username":{
    "name":"用户名", // 字段的名称
    "desc":"用户名的描述", // 字段的描述说明
    "type":"string" // 字段的类型， (可选) 不填写时默认是string
    "required":true, // 字段是否必填，(可选) 不填写的时候默认是必填
    "default":null // 字段的默认值，(可选) 不填写时默认是空
    "enum":[] // 字段的枚举值，(可选) 表示字段职能从这几个字段中有值，比如["edison","lemon","jay"], 
    // 那么username只能是这3个值中的一个
}
```
当我们不写`desc`属性时，默认为空，不写`required`属性时，默认为true, 也就是这个字段是必填的。

### 字段的类型
字段的类型一共有这几种
1. string 字符串 "aaa"
2. number 数字 1、2
3. bool 布尔值 true、false
4. object 对象 {}
5. array 数组 []
