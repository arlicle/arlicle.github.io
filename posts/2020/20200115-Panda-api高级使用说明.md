{
    :title "Panda api 高级使用说明"
    :post-date "2020-01-15 20:05"
}


### 全局字段属性，不需要重复写相同的字段
我们在上一篇的简易教学文章中，用户登录接口和用户退出接口的response返回字段，都有一个`code`字段和`msg`字段，
```.language-json
"response":{
    "code":{...}
    "msg":{...}
}
```

实际上，很有可能，我们整个系统的接口，都遵循同样的标准，所有接口都有`code`字段和`msg`字段，那么，每个地方的body和response都去写岂不是很麻烦；另外，可能我们整个网站绝大部分的接口都是要登录的，只有很少的一小部分不需要登录，每个都去设置也很麻烦啊。我承认就是懒，所以Panda api提供了一个简单的全局设置方法。

打开`_settings.json`文件
```.language-json
{
  "project_name": "Panda Api", // 项目名称
  "project_desc": "Panda Api is a simple api manage tool" // 项目简述
}
```

我们增加`global`字段，内容变为：

```.language-json
{
  "project_name": "Panda Api",
  "project_desc": "Panda Api is a simple api manage tool",
  "global": {
    "api":{
      "auth": true,
      "response":{
        "code":{"name":"返回的状态码", "type":"number"},
        "msg":{"name":"返回的状态说明"}
      }
    },
  }
}
```

这样我们设置了全局api接口的`auth`字段全部为`true`，全局的`response`都有了字段`code`和`msg`，我们可以打开我们的接口文档来查看`http://localhost:9000`

当然，我们的用户登录接口`/login`是不需要验证用户登录的，我们可以在用户登录接口中单独设置`auth`为`false`，这就像继承的概念一样。
```.language-json
{
    "name":"用户登录",
    "desc":"用户登录成功，接口会返回一个token",
    "method": "POST",
    "url":"/login/",
    "auth":false, // 单独设置登录接口不需要验证和用户登录状态
    "body_mode":"json",
    "body":...
```
`code`字段和`msg`字段，如果有的地方不需要这两个字段，就不能简单的像auth字段一样修改一个值，你要做的是再不需要的地方设置删除。

```.language-json
"response":{
    "code":"$del", // 删除继承得来的code字段
    "msg":"$del", // 删除继承得来的msg字段
    ...
}
```

这个时候设置了值为`$del`的字段就没有了，我们可以刷新前端文档看一下。

### 重用相同的数据模型

有时候，几个接口的字段差不多，又只是几个接口会这样，是不能用全局设置来表示的，比如用户操作的文章列表的字段、文章添加的字段、文章查看的字段差不多，如果字段很多，每个都重复写就很累，虽然可以复制粘贴，但是维护的时候又要同时维护多个地方，带来了麻烦。

所以Panda api上我参考swagger设计了`$ref`语法，方便的引用数据模型，此外又增加了`exclude`语法和继承语法，让我们使用起来更方便，我们来看例子吧。


我们的文章的接口文档是这样的：

```.language-json
{
    "name":"文章接口",
    "api":[
        {
            "name":"文章添加/编辑",
            "url":"/post/add/",
            "body":{
                "id":{"name":"文章id", "desc":"添加提交的时候是没有id, 编辑提交的时候才有", "type":"number", "required":false},
                "title":{"name":"文章标题"},
                "summary":{"name":"文章摘要"},
                "category_id":{"name":"文章分类id", "type":"number"},
                "author_name":{"name":"文章作者姓名"},
                "source":{"name":"文章来源"},
                "tag":{"name":"文章标签"}
            },
            "response":{
                // code 和 msg 字段来自全局了
                "id": {"name":"文章id"}
            }
        },
        {
            "name":"查看文章",
            "method":"POST",
            "url":"/post/{id:\\d+}/",
            "body":{
                "page":{"name":"分页", "type":"number"}
            },
            "response":{
                // code 和 msg 字段来自全局了
                "total_page": {"name":"总页数", "type":"number"},
                "total_count": {"name":"总记录数", "type":"number"},
                "current_page": {"name":"当前页码", "type":"number"},
                "result": 
                    [{
                        "id":{"name":"文章id", "desc":"添加提交的时候是没有id, 编辑提交的时候才有", "type":"number"}, // 这时id是必有的
                        "title":{"name":"文章标题"},
                        "summary":{"name":"文章摘要"},
                        "category_name":{"name":"文章分类名称"},
                        "author_name":{"name":"文章作者姓名"},
                        "source":{"name":"文章来源"},
                        "tag":{"name":"文章标签"},
                        "read_count":{"name":"阅读次数", "type":"number"},
                        "created":{"name":"创建时间", "type":"number"},
                        "create_username":{"name":"文章创建人姓名"}
                    }]
                
            }
        },
        {
            "name":"文章列表",
            "method":"POST",
            "url":"/post/star/list/",
            "body":{
                "page":{"name":"分页", "type":"number"}
            },
            "response":{
                "total_page": {"name":"总页数", "type":"number"},
                "total_count": {"name":"总记录数", "type":"number"},
                "current_page": {"name":"当前页码", "type":"number"},
                "result": 
                    [{
                        "id":{"name":"文章id", "desc":"添加提交的时候是没有id, 编辑提交的时候才有", "type":"number"}, // 这时id是必有的
                        "title":{"name":"文章标题"},
                        "category_name":{"name":"文章分类名称"},
                        "author_name":{"name":"文章作者姓名"},
                        "tag":{"name":"文章标签"},
                        "created":{"name":"创建时间"},
                    }]
            }
        }
    ]
}
```

我们的文章接口文档里面一共有三个接口：文章添加，文章查看，文章列表，

如果以文章添加为基础来看的话，文章查看与文章添加的区别是：id变为了必填，category_id变为了category_name，增加了3个字段`read_count`阅读次数，`created`创建时间，`create_username`文章创建人姓名，

```.language-json
"title":{"name":"文章标题"},
"summary":{"name":"文章摘要"},
"category_id":{"name":"文章分类id", "type":"number"},
"author_name":{"name":"文章作者姓名"},
"source":{"name":"文章来源"},
"tag":{"name":"文章标签"}
```
这个部分的字段是一模一样的，

再看文章列表，`id`，`title`，`author_name`，`tag`，是一样的，`category_name`、`author_name`、`created`是增加字段。

实际上，这些新增的字段也都是文章模型的属性，相同的不同字段分开写就导致如果发生字段调整，属性调整，要维护的地方就会很多，容易出错。

所以Panda api设计的是，我们可以统一设计一个模型，然后每次调用的时候，只调用需要的部分。这样写和维护就统一只在一个地方。

创建文件夹 `_data`, 在`_data`文件夹中创建文件`models.json`(文件名可以根据自己的需要设定)，

